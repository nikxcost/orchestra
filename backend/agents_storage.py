"""
–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∞–≥–µ–Ω—Ç–æ–≤.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ JSON —Ñ–∞–π–ª.
"""

import json
from pathlib import Path
from typing import Dict, List, Optional
from datetime import datetime


class Agent:
    """–ú–æ–¥–µ–ª—å –∞–≥–µ–Ω—Ç–∞"""
    def __init__(
        self,
        id: str,
        name: str,
        description: str,
        prompt: str,
        color: str = "bg-gray-500",
        created_at: Optional[str] = None,
        updated_at: Optional[str] = None
    ):
        self.id = id
        self.name = name
        self.description = description
        self.prompt = prompt
        self.color = color
        self.created_at = created_at or datetime.now().isoformat()
        self.updated_at = updated_at or datetime.now().isoformat()

    def to_dict(self) -> dict:
        return {
            "id": self.id,
            "name": self.name,
            "description": self.description,
            "prompt": self.prompt,
            "color": self.color,
            "created_at": self.created_at,
            "updated_at": self.updated_at
        }

    @classmethod
    def from_dict(cls, data: dict) -> 'Agent':
        return cls(**data)


class AgentsStorage:
    """–•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ JSON"""

    def __init__(self, file_path: str = "agents_config.json"):
        self.file_path = Path(file_path)
        self.agents: Dict[str, Agent] = {}
        self._load()

    def _load(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"""
        if self.file_path.exists():
            try:
                with open(self.file_path, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    self.agents = {
                        agent_id: Agent.from_dict(agent_data)
                        for agent_id, agent_data in data.items()
                    }
                print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.agents)} –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ {self.file_path}")
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤: {e}. –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.")
                self._create_default_agents()
        else:
            print(f"üìù –§–∞–π–ª {self.file_path} –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞—ë–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.")
            self._create_default_agents()
            self._save()

    def _create_default_agents(self):
        """–°–æ–∑–¥–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∞–≥–µ–Ω—Ç–æ–≤"""
        self.agents = {
            "agent1": Agent(
                id="agent1",
                name="–ê–≥–µ–Ω—Ç –≤–æ–ø—Ä–æ—Å–æ–≤",
                description="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤",
                color="bg-blue-500",
                prompt="""–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞, –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–±–ª–µ–º–∞, draft —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π), –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π, –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º, —á—Ç–æ–±—ã:
- –£—Ç–æ—á–Ω–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
- –°–Ω—è—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏.
- –ó–∞–∫—Ä—ã—Ç—å —Å–ª–µ–ø—ã–µ –∑–æ–Ω—ã –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å, –ø–æ–ª–Ω–æ—Ç—É –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.
- –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫—Ä–∏—Ç–µ—Ä–∏—è–º –∫–∞—á–µ—Å—Ç–≤–∞ (—è—Å–Ω–æ—Å—Ç—å, –ø–æ–ª–Ω–æ—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å, –Ω–µ–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–æ—Å—Ç—å, –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å).

–≠—Ç–∞–ø 1. –ê–Ω–∞–ª–∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
–ü–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤:
- –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏, –∫–∞–∫ —Ç—ã –ø–æ–Ω—è–ª —Å—É—Ç—å –∑–∞–¥–∞—á–∏ (1‚Äì2 –∞–±–∑–∞—Ü–∞).
- –Ø–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π –∫–ª—é—á–µ–≤—ã–µ –¥–æ–ø—É—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –≤—ã–Ω—É–∂–¥–µ–Ω —Å–¥–µ–ª–∞—Ç—å –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –£–∫–∞–∂–∏, –∫–∞–∫–æ–≥–æ —Ç–∏–ø–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤–æ –≤—Ö–æ–¥–Ω–æ–º —Ç–µ–∫—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –¥–æ—Ä–∞–±–æ—Ç–∫–∞, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏ —Ç.–ø.).

–≠—Ç–∞–ø 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
–°—Ñ–æ—Ä–º–∏—Ä—É–π —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –±–ª–æ–∫–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –†–∏—Å–∫–∏ –∏ –¥–æ–ø—É—â–µ–Ω–∏—è
- –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ä–æ–ª–∏
- –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞:
- –ü–µ—Ä–µ—á–∏—Å–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –∑–∞–¥–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫.
- –§–æ—Ä–º—É–ª–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å—ã —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏, —É—Ç–æ—á–Ω—è—é—â–∏–º–∏ –∏ —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–ª–∏ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏.
- –ò–∑–±–µ–≥–∞–π –Ω–∞–≤–æ–¥—è—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º¬ª –æ—Ç–≤–µ—Ç–µ.
- –û–≥—Ä–∞–Ω–∏—á—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî 7‚Äì10 –Ω–∞ –±–ª–æ–∫, –æ–±—ä–µ–¥–∏–Ω—è—è –±–ª–∏–∑–∫–∏–µ –ø–æ —Å–º—ã—Å–ª—É.

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å—ã
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —É–∫–∞–∂–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- P0 ‚Äî –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.
- P1 ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∫–∏ —Å—Ä–æ–∫–æ–≤/—Å—Ç–æ–∏–º–æ—Å—Ç–∏.
- P2 ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—Ç.

–û—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ —Å–ª–µ–ø—ã–µ –∑–æ–Ω—ã
–ï—Å–ª–∏ –≤–æ –≤—Ö–æ–¥–Ω–æ–º —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å:
- –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è,
- —Ä–∞–∑–º—ã—Ç—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏,
- –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Ü–µ–ª–∏ –∏–ª–∏ –º–µ—Ç—Ä–∏–∫–∏,
- –Ω–µ—è–≤–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏–ª–∏ –¥–æ–ø—É—â–µ–Ω–∏—è,
–≤—ã–¥–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ ¬´–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ —Å–ª–µ–ø—ã–µ –∑–æ–Ω—ã¬ª –∏ –∑–∞–¥–∞–π –ø—Ä–æ—è—Å–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—è —Ä–µ—à–µ–Ω–∏–π –∏ –Ω–µ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—è –æ–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç.

–ò—Ç–æ–≥–æ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ –æ—Ç–≤–µ—Ç—É
–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º,
- –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º,
- –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å–æ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏,
- –ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ discovery, refinement –∏–ª–∏ –∑–∞—â–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π."""
            ),
            "agent2": Agent(
                id="agent2",
                name="–ê–≥–µ–Ω—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",
                description="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–±–æ—Ä—É –∏ –∞–Ω–∞–ª–∏–∑—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",
                color="bg-green-500",
                prompt="–í—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–±–æ—Ä—É –∏ –∞–Ω–∞–ª–∏–∑—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π."
            ),
            "agent3": Agent(
                id="agent3",
                name="–ê–≥–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏",
                description="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏",
                color="bg-yellow-500",
                prompt="–í—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏."
            ),
            "agent4": Agent(
                id="agent4",
                name="–ê–≥–µ–Ω—Ç –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è",
                description="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤",
                color="bg-orange-500",
                prompt="–í—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤."
            ),
            "agent5": Agent(
                id="agent5",
                name="–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫",
                description="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ–±—â–µ–º—É –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑—É",
                color="bg-red-500",
                prompt="–í—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ–±—â–µ–º—É –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑—É."
            )
        }

    def _save(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª"""
        try:
            data = {
                agent_id: agent.to_dict()
                for agent_id, agent in self.agents.items()
            }
            with open(self.file_path, 'w', encoding='utf-8') as f:
                json.dump(data, f, indent=2, ensure_ascii=False)
            print(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(self.agents)} –∞–≥–µ–Ω—Ç–æ–≤ –≤ {self.file_path}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤: {e}")
            raise

    def get_all(self) -> List[dict]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤"""
        return [agent.to_dict() for agent in self.agents.values()]

    def get_by_id(self, agent_id: str) -> Optional[dict]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –ø–æ ID"""
        agent = self.agents.get(agent_id)
        return agent.to_dict() if agent else None

    def update(self, agent_id: str, name: str, description: str, prompt: str, color: str) -> dict:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∞–≥–µ–Ω—Ç–∞"""
        if agent_id not in self.agents:
            raise ValueError(f"–ê–≥–µ–Ω—Ç {agent_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

        agent = self.agents[agent_id]
        agent.name = name
        agent.description = description
        agent.prompt = prompt
        agent.color = color
        agent.updated_at = datetime.now().isoformat()

        self._save()
        return agent.to_dict()

    def get_prompts_dict(self) -> Dict[str, str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ orchestrator"""
        return {
            agent_id: agent.prompt
            for agent_id, agent in self.agents.items()
        }

    def get_descriptions_dict(self) -> Dict[str, str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å –æ–ø–∏—Å–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è routing"""
        return {
            agent_id: f"{agent.name} - {agent.description}"
            for agent_id, agent in self.agents.items()
        }


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
_storage = None

def get_storage() -> AgentsStorage:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç singleton –∏–Ω—Å—Ç–∞–Ω—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"""
    global _storage
    if _storage is None:
        _storage = AgentsStorage()
    return _storage

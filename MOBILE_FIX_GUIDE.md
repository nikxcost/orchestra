# ะะฝััััะบัะธั ะฟะพ ะธัะฟัะฐะฒะปะตะฝะธั ะฟัะพะฑะปะตะผั "Backend ะฝะต ะทะฐะฟััะตะฝ" ะฝะฐ ะผะพะฑะธะปัะฝะพะผ

## ๐ ะะธะฐะณะฝะพััะธะบะฐ ะฟัะพะฑะปะตะผั

ะัะพะฑะปะตะผะฐ ะฑัะปะฐ ะฒ ะบััะธัะพะฒะฐะฝะธะธ ะฑัะฐัะทะตัะฐ. ะะฐะถะต ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั ะบะพะดะฐ ะฝะฐ ัะตัะฒะตัะต, ะผะพะฑะธะปัะฝัะน ะฑัะฐัะทะตั ะฟัะพะดะพะปะถะฐะป ะธัะฟะพะปัะทะพะฒะฐัั ััะฐััั ะฒะตััะธั JavaScript, ะบะพัะพัะฐั ะพะฑัะฐัะฐะปะฐัั ะบ `localhost:8000` ะฒะผะตััะพ `http://109.69.22.56/api`.

### ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ:

โ **Frontend ะบะพะฝัะธะณััะฐัะธั** - `.env` ะฝะฐัััะพะตะฝ ะฝะฐ `http://109.69.22.56/api`
โ **Backend CORS** - ะดะพะฑะฐะฒะปะตะฝ `http://109.69.22.56` ะฒ ัะฐะทัะตัะตะฝะฝัะต origins
โ **API Key** - ะฝะฐัััะพะตะฝ ะธ ัะพะฒะฟะฐะดะฐะตั ะผะตะถะดั frontend ะธ backend
โ **Nginx proxy** - ะฟัะฐะฒะธะปัะฝะพ ะฟัะพะบัะธััะตั `/api/` ะฝะฐ backend
โ **Cache headers** - ะดะพะฑะฐะฒะปะตะฝั ะทะฐะณะพะปะพะฒะบะธ ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะบััะธัะพะฒะฐะฝะธั HTML

---

## ๐ ะจะฐะณะธ ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั ะธัะฟัะฐะฒะปะตะฝะธั

### 1. ะะฐ ะฒะฐัะตะผ ะปะพะบะฐะปัะฝะพะผ ะบะพะผะฟัััะตัะต

```bash
# ะฃะฑะตะดะธัะตัั, ััะพ ะฒัะต ะธะทะผะตะฝะตะฝะธั ะทะฐะบะพะผะผะธัะตะฝั
git status

# ะะฐะฟััััะต ะธะทะผะตะฝะตะฝะธั ะฝะฐ ัะตัะฒะตั
git push origin main
```

### 2. ะะฐ ัะตัะฒะตัะต (109.69.22.56)

```bash
# ะะพะดะบะปััะธัะตัั ะบ ัะตัะฒะตัั
ssh root@109.69.22.56

# ะะตัะตะนะดะธัะต ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd /root/orchestra

# ะะฐะฟัััะธัะต ัะบัะธะฟั ะดะตะฟะปะพั
./deploy.sh
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะะพะดััะฝะตั ะฟะพัะปะตะดะฝะธะต ะธะทะผะตะฝะตะฝะธั ะธะท Git
- ะะตัะตัะพะฑะตััั frontend ั ะฟัะฐะฒะธะปัะฝะพะน ะบะพะฝัะธะณััะฐัะธะตะน
- ะะฑะฝะพะฒะธั nginx ะบะพะฝัะธะณััะฐัะธั ั ะฝะพะฒัะผะธ cache headers
- ะะตัะตะทะฐะฟัััะธั backend ะธ nginx

### 3. ะัะพะฒะตัะบะฐ ัะฐะทะฒะตัััะฒะฐะฝะธั

ะะพัะปะต ะดะตะฟะปะพั, ะฒัะฟะพะปะฝะธัะต ะฝะฐ ัะตัะฒะตัะต:

```bash
cd /root/orchestra
./verify-deployment.sh
```

ะกะบัะธะฟั ะฟัะพะฒะตัะธั:
- โ ะะฐะฑะพัั API health endpoint
- โ ะะฐะปะธัะธะต CORS ะทะฐะณะพะปะพะฒะบะพะฒ
- โ ะะพัััะฟะฝะพััั frontend
- โ ะัะฐะฒะธะปัะฝะพััั API URL ะฒ JavaScript
- โ Cache headers ะดะปั HTML

---

## ๐ฑ ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ ะผะพะฑะธะปัะฝะพะผ ััััะพะนััะฒะต

### ะะฐัะธะฐะฝั 1: ะัะธััะบะฐ ะบััะฐ (ะะตะบะพะผะตะฝะดัะตััั)

**ะะฐ iPhone (Safari):**
1. Settings โ Safari โ Clear History and Website Data
2. ะัะบัะพะนัะต http://109.69.22.56
3. ะะพััะฝะธัะต ัััะฐะฝะธัั ะฒะฝะธะท ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั

**ะะฐ Android (Chrome):**
1. Settings โ Privacy โ Clear browsing data
2. ะัะฑะตัะธัะต "Cached images and files"
3. ะัะบัะพะนัะต http://109.69.22.56
4. ะะตะฝั โ ะะฑะฝะพะฒะธัั

### ะะฐัะธะฐะฝั 2: ะัะธะฒะฐัะฝัะน ัะตะถะธะผ (ะัััััะน ัะตัั)

**Safari:** ะะฐะถะผะธัะต ะฝะฐ ะธะบะพะฝะบั ะฒะบะปะฐะดะพะบ โ Private โ ะพัะบัะพะนัะต http://109.69.22.56
**Chrome:** ะะตะฝั โ New Incognito Tab โ ะพัะบัะพะนัะต http://109.69.22.56

### ะะฐัะธะฐะฝั 3: ะะพะฑะฐะฒะธัั ะฒะตััะธั ะบ URL (ะัะตะผะตะฝะฝะพะต ัะตัะตะฝะธะต)

ะัะบัะพะนัะต: `http://109.69.22.56/?v=2`

---

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### Nginx Cache Headers

ะะฑะฝะพะฒะปะตะฝะฝะฐั ะบะพะฝัะธะณััะฐัะธั ([nginx-orchestra.conf](nginx-orchestra.conf#L15-L26)):

```nginx
# HTML ัะฐะนะปั - ะฝะธะบะพะณะดะฐ ะฝะต ะบััะธัะพะฒะฐัั
location ~* \.html$ {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}

# JS/CSS ัะฐะนะปั - ะบััะธัะพะฒะฐัั ะฝะฐ 1 ะณะพะด (ะพะฝะธ ะธะผะตัั ััั ะฒ ะธะผะตะฝะธ)
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### API Configuration

**Frontend** ([.env](.env#L3)):
```env
VITE_API_BASE_URL=http://109.69.22.56/api
VITE_API_KEY=CNRaeNw0q5XIMQJNN_9nC8O3X1l5HUT2sD83MXd68xk
```

**Backend** ([backend/.env](backend/.env#L8)):
```env
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000,http://127.0.0.1:5173,http://109.69.22.56
API_KEY=CNRaeNw0q5XIMQJNN_9nC8O3X1l5HUT2sD83MXd68xk
```

---

## ๐ ะัะปะธ ะฟัะพะฑะปะตะผะฐ ัะพััะฐะฝัะตััั

### ะัะพะฒะตัััะต DevTools ะฒ ะผะพะฑะธะปัะฝะพะผ ะฑัะฐัะทะตัะต:

**Safari (iPhone):**
1. ะะฐ Mac: Safari โ Develop โ [Your iPhone] โ [Page name]
2. ะัะพะฒะตัััะต Console ะฝะฐ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ
3. ะัะพะฒะตัััะต Network tab - ะบ ะบะฐะบะพะผั URL ะธะดัั ะทะฐะฟัะพัั

**Chrome (Android):**
1. ะะฐ ะบะพะผะฟัััะตัะต: chrome://inspect/#devices
2. ะะพะดะบะปััะธัะต ัะตะปะตัะพะฝ ะฟะพ USB
3. ะะฐะถะผะธัะต "Inspect" ะฝะฐ ะฒะฐัะตะน ัััะฐะฝะธัะต
4. ะัะพะฒะตัััะต Console ะธ Network

### ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ัะตัะฒะตัะฐ:

```bash
# ะก ัะตะปะตัะพะฝะฐ ะฒ ะฑัะฐัะทะตัะต ะพัะบัะพะนัะต:
http://109.69.22.56/api/health

# ะะพะปะถะฝะพ ะฒะตัะฝััั:
{"status":"healthy"}
```

### ะัะพะฒะตัััะต ัะฐะนัะฒะพะป:

```bash
# ะะฐ ัะตัะฒะตัะต
sudo ufw status

# ะฃะฑะตะดะธัะตัั, ััะพ ะฟะพัั 80 ะพัะบััั
sudo ufw allow 80/tcp
```

---

## โ ะัะธัะตัะธะธ ััะฟะตัะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั

ะะพัะปะต ะฒัะตั ัะฐะณะพะฒ ะฒั ะดะพะปะถะฝั ัะฒะธะดะตัั:

1. โ ะะฐ ะบะพะผะฟัััะตัะต ะฒ ะฑัะฐัะทะตัะต http://109.69.22.56 ัะฐะฑะพัะฐะตั
2. โ ะ ะปะตะฒะพะผ ะฝะธะถะฝะตะผ ัะณะปั ะธะฝะดะธะบะฐัะพั ะฟะพะบะฐะทัะฒะฐะตั "ะะฝะปะฐะนะฝ" (ะทะตะปัะฝัะน)
3. โ ะะฐ ัะตะปะตัะพะฝะต ะฒ ะฑัะฐัะทะตัะต http://109.69.22.56 ะพัะบััะฒะฐะตััั
4. โ ะะฐ ัะตะปะตัะพะฝะต ะผะพะถะฝะพ ะพัะฟัะฐะฒะปััั ะทะฐะฟัะพัั ะบ ะฐะณะตะฝัะฐะผ
5. โ ะะตั ัะพะพะฑัะตะฝะธั "Backend ะฝะต ะทะฐะฟััะตะฝ"

---

## ๐ ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

```
โโโโโโโโโโโโโโโ
โ   ะขะตะปะตัะพะฝ   โ
โ   Browser   โ
โโโโโโโโฌโโโโโโโ
       โ http://109.69.22.56/
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Nginx (Port 80)          โ
โ  โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ โ
โ  โ Static     โ API Proxy      โ โ
โ  โ /          โ /api/ โ :8000/ โ โ
โ  โ (React)    โ (FastAPI)      โ โ
โ  โโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
       โโโโโโโโโโโโโโโโโโโ
       โ FastAPI Backend โ
       โ   Port 8000     โ
       โ  (Systemd)      โ
       โโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

ะะพัะปะต ััะฟะตัะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ัะตะบะพะผะตะฝะดัะตััั:

1. โ๏ธ **ะะฐัััะพะธัั HTTPS** - HTTP ะฝะตะฑะตะทะพะฟะฐัะตะฝ ะดะปั production
2. ๐ **ะะพัะฐัะธั API ะบะปััะตะน** - ัะตะบััะธะต ะบะปััะธ ะฒ ะฟัะฑะปะธัะฝะพะผ ัะตะฟะพะทะธัะพัะธะธ
3. ๐ **ะะพะฝะธัะพัะธะฝะณ** - ะฝะฐัััะพะธัั ะปะพะณะธ ะธ ะฐะปะตััั
4. ๐พ **ะัะบะฐะฟั** - ัะตะณัะปััะฝัะต ะฑัะบะฐะฟั ะบะพะฝัะธะณััะฐัะธะธ ะธ ะดะฐะฝะฝัั

---

ะกะพะทะดะฐะฝะพ: 2025-12-26
ะะตััะธั: 1.0
